name: Update Pull Request Description

on:
  pull_request:
    types: [opened]

jobs:
  update_description:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set Pull Request Description
        run: |
          # Extract details from the pull request
          OWNER="${{ github.actor }}"
          TITLE="${{ github.event.pull_request.title }}"
          BRANCH_NAME="${{ github.head_ref }}"
          
          # Extract ticket number and short description from the branch name
          TICKET_NUMBER=$(echo "$BRANCH_NAME" | cut -d'-' -f1)
          SHORT_DESCRIPTION=$(echo "$BRANCH_NAME" | cut -d'-' -f2)
          ENVIRONMENT=$(echo "$BRANCH_NAME" | cut -d'-' -f3)

          # Create the new pull request body
          PR_BODY="**Pull Request Owner:** $OWNER\n"
          PR_BODY+="**Pull Request Title:** $TITLE\n"
          PR_BODY+="**Short Description:** $SHORT_DESCRIPTION\n"
          PR_BODY+="**Ticket Number:** $TICKET_NUMBER\n"
          PR_BODY+="**Environment:** $ENVIRONMENT\n"
          PR_BODY+="**Reviewers:** ${{ toJson(github.event.pull_request.requested_reviewers) }}\n"
          PR_BODY+="**Comments:** ${{ github.event.pull_request.body }}"

          # Update the pull request body using GitHub API
          curl -X PATCH \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }} \
            -d "{\"body\": \"$PR_BODY\"}"
